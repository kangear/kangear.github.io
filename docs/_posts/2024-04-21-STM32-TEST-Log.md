---
layout: post
title:  "STM32维修日志"
date:   2024-04-21 16:00:00 +0800
categories: cloud
typora-copy-images-to: ../assets
typora-root-url: ../
---

# 问题：烧录固件后指示灯常亮，主板不启动调试串口无任何打印
解决过程：

MCU型号：STM32F103C8T6   
板子版本：20240404   
固件版本：Fisher_240419_1651.hex   

重新烧录并更换串口工具都没有解决。烧录固件之前一切正常，只是偶尔网络重连不上，然后就烧录固件想排除固件问题，查看4G固件了也是1159最新版本，但是再MCU中烧录最新固件结果不启动了。烧录Fisher_240313_2337.hex（无RTC功能）后可以启动，说明硬件问题不大，很可能是RTC导致无法启动。几天前也出现过这个问题，但是在测试新固件的时候还谎报军情说固件不能启动，不过最终什么也没有做，放一了一会好了，这次的问题还没有解决。果不其然，等了5分钟后再烧录可以正常启动了，但是这个是经验，如果再遇到应该怎么办，这比较随机。


# 问题：烧录固件后指示灯不亮，MCU不启动调试串口无任何打印
解决过程：

MCU型号：STM32F103C8T6   
板子版本：20240414   
固件版本：Fisher_240419_1651.hex   

这块板子遗落在了贴片厂，今天去的时候意外看到带回。看了之前的使用记录，之前可以正常启动和连网的，现在能烧录程序，但是完全不启动，根据经验判断RTC问题。烧旧固件可以启动，进一步证明是此问题，测试VBAT有电压3.0V；那么就很可能是32.768kHz晶振有问题，更换后可以正常启动了。

# 问题：VBAT不接纽扣电池无法启动
解决过程：

MCU型号：STM32F103C8T6   
板子版本：20240414   
固件版本：Fisher_240419_1651.hex   

经过反复测试，代码中不配置RTC则可以正常启动；如果配置RTC时VBAT必须接纽扣电池，就连接到3.3V和VDD同步上电都不行。这个问题在`Blue Pill`开发板上复现出来了。

VBAT管脚可能性

| VBAT连接 | 测试结果 | 备注 |
| :----: | :----: | :----: |
| U转串的VCC | 可以启动 | 类似外接纽扣电池 |
| STM32 VCC | 不可以  | 按说可以，因为博客有相关例子  |
| 悬空 | 不可以  | -  |

此问题暂未解决，初步判断是程序或者STM32配置问题。

