---
layout: post
title:  "STM32维修日志"
date:   2024-04-21 16:00:00 +0800
categories: cloud
typora-copy-images-to: ../assets
typora-root-url: ../
---

# 问题：烧录固件后指示灯常亮，主板不启动调试串口无任何打印
解决过程：

MCU型号：STM32F103C8T6   
板子版本：20240404   
固件版本：Fisher_240419_1651.hex   

重新烧录并更换串口工具都没有解决。烧录固件之前一切正常，只是偶尔网络重连不上，然后就烧录固件想排除固件问题，查看4G固件了也是1159最新版本，但是再MCU中烧录最新固件结果不启动了。烧录Fisher_240313_2337.hex（无RTC功能）后可以启动，说明硬件问题不大，很可能是RTC导致无法启动。几天前也出现过这个问题，但是在测试新固件的时候还谎报军情说固件不能启动，不过最终什么也没有做，放一了一会好了，这次的问题还没有解决。果不其然，等了5分钟后再烧录可以正常启动了，但是这个是经验，如果再遇到应该怎么办，这比较随机。


# 问题：烧录固件后指示灯不亮，MCU不启动调试串口无任何打印
解决过程：

MCU型号：STM32F103C8T6   
板子版本：20240414   
固件版本：Fisher_240419_1651.hex   

这块板子遗落在了贴片厂，今天去的时候意外看到带回。看了之前的使用记录，之前可以正常启动和连网的，现在能烧录程序，但是完全不启动，根据经验判断RTC问题。烧旧固件可以启动，进一步证明是此问题，测试VBAT有电压3.0V；那么就很可能是32.768kHz晶振有问题，更换后可以正常启动了。

# 问题：VBAT不接纽扣电池无法启动
解决过程：

MCU型号：STM32F103C8T6   
板子版本：20240414   
固件版本：Fisher_240419_1651.hex   

经过反复测试，代码中不配置RTC则可以正常启动；如果配置RTC时VBAT必须接纽扣电池，就连接到3.3V和VDD同步上电都不行。这个问题在`Blue Pill`开发板上复现出来了。

VBAT管脚可能性

| VBAT连接 | 测试结果 | 备注 |
| :----: | :----: | :----: |
| U转串的VCC | 可以启动 | 类似外接纽扣电池 |
| STM32 VCC | 不可以  | 按说可以，因为博客有相关例子  |
| 悬空 | 不可以  | -  |

此问题暂未解决，初步判断是程序或者STM32配置问题。

更新：

目前解决方案是，空片第一次烧录程序时不装钮扣电池即可，或者出现不启动时拆装一下纽扣电池即可。目前勉强能应付客户。

至于不装纽扣电池启动的问题，需要后续进一步研究解决。

更新：

问题已解决，研发工程师告知我是"Arm核问题"，具体是怎么修改的软件解决的，不得而知，反正现在的现象是可以不安装电池启动了。

# 问题：ST-Link无法第二次识别
解决过程：

MCU型号：STM32F103C8T6   
板子版本：20240502   
固件版本：Fisher_240419_1651.hex   

成功烧录过一次程序，然后就再也无法正常识别，程序本身可以正常运行。

ST-Link提示的信息有：
```
ERROR
Can not connect to target!
Please select "connect Under Reset" mode from Target->Settings menu and try again. 
If you're trying to connect to a low frequengy application. 
please select a lower SWD Frequengy mode fromTarget->Settings menu.
```

试过按照提示设置因为没有接出RST，所以无效；也尝试将MCU的RST接GND，但是能实现重启，还是无法连接烧录器。

此问题暂未解决，初步判断是STM32芯片问题，找机会更换一下测试。

解决方案：

更换杜邦线。杜邦线已经没有紧的感觉了，已经连续用了三个月。


# 问题：STM32 32.768kHz不起振
解决过程：

MCU型号：STM32F103C8T6   
板子版本：20240505   
固件版本：Fisher_240419_1651.hex   

烧录程序正常，但是不启动，改用无RTC功能的程序可以正常启动，锁定VBAT和32.768kHz两块。经过检测VBAT电压正常，32.768晶振因为没有示波器，暂时无法确定是否起振。对比开发板上的丝印如下：

```
32.768k
E CG7
```

经过对比是`MC-306 EPSON`，在查看其说明书的时候，以及对比`Blue Pill`原理图，发现原理图只用了两个脚，而我用的四个脚。经过询问伙伴才得知只需要使用两个脚即可，datasheet中也标准有两个2、3两个脚是连在一起没有任务使用，而我却把负载电容接到了2、3上，我开始想着把2和1、3和4分别连在一起应该能解决问题，最终不行，确认是2、3是连在一起的，等于晶振两个脚短路在一起了。硬改了一下好了，带有RTC功能的程序也可以正常启动。

# 问题：JW5033S电压输出不正常

解决过程：

MCU型号：JW5033S   
板子版本：-   
固件版本：-

按照《Air780E硬件手册》中的参考电路添加了一个电源电路，稳定给出4.1V电压给模块使用，但是打板回来完全没有输出，最后重新焊接一块板子有输出2.1V，但是不符合逻辑。问题暂未解决，开始怀疑封装是不是错了, 购买的丝印是`JWHSJ`，经过确认是淘宝上都叫`SOT23-6`，手册中EDA中都叫`TSOT-23-6`，多了一个T但是对比不是手册上另一个封装`SOT563`。

此问题暂未解决。

# 问题：STM32电流200mA发烫

解决过程：

MCU型号：STM32F103C8T6   
板子版本：-   
固件版本：-

芯片是淘宝上购买的，很便宜像是翻新的IC，上电后功能正常，但是出现了标题的问题，昨天将其更换后电流恢复正常，也不发烫了。